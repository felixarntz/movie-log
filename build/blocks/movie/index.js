(()=>{"use strict";var e,t={165:(e,t,r)=>{const o=window.wp.blocks,n=window.wp.components,i=window.wp.serverSideRender;var s=r.n(i);const a=window.wp.blockEditor,d=window.wp.data,l=window.wp.element,c=window.wp.date,m=window.wp.i18n,u=window.wp.apiFetch;var w=r.n(u);const p=window.wp.url,b={};async function v(e,{signal:t}={}){let r,o;if(h(e)){if(b[e])return b[e];r=`/movie-log/v1/imdb-proxy/${e}`,o={}}else r="/movie-log/v1/imdb-proxy",o={search:e};const n=await w()({path:(0,p.addQueryArgs)(r,o),signal:t});if(!h(e)){if(!n.length)throw{code:"movie_not_found"};return g(n[0]),n[0]}return g(n),n}function g(e){b[e.imdbID]=e}function h(e){return e&&!!e.match(/^tt\d+$/)}const f=JSON.parse('{"UU":"movie-log/movie"}'),y=window.ReactJSXRuntime,_={per_page:-1,orderby:"name",order:"asc",_fields:"id,name",context:"view"},x=[];(0,o.registerBlockType)(f.UU,{edit:function({attributes:e,setAttributes:t}){const o=window.movieLogSettings.genreTaxonomy,{imdbId:i}=e,{hasCreateAction:u,hasAssignAction:w,taxonomy:p,postTerms:b,availableTerms:g,loadingTerms:h,postTitle:T,postMeta:I}=(0,d.useSelect)((e=>{var t,r;const{getCurrentPost:n,getEditedPostAttribute:i}=e("core/editor"),{getTaxonomy:s,getEntityRecords:a,isResolving:d}=e("core"),l=s(o),c=n();return{hasCreateAction:!!l&&null!==(t=c._links?.["wp:action-create-"+l.rest_base])&&void 0!==t&&t,hasAssignAction:!!l&&null!==(r=c._links?.["wp:action-assign-"+l.rest_base])&&void 0!==r&&r,taxonomy:l,postTerms:l?i(l.rest_base):x,availableTerms:a("taxonomy",o,_)||x,loadingTerms:d("getEntityRecords",["taxonomy",o,_]),postTitle:i("title"),postMeta:i("meta")}})),[j,k]=(0,l.useState)(void 0),[O,C]=(0,l.useState)(!1),[A,S]=(0,l.useState)(void 0),{editPost:D}=(0,d.useDispatch)("core/editor"),{saveEntityRecord:E}=(0,d.useDispatch)("core");return(0,l.useEffect)((()=>{if(!i)return;if(i===A?.imdbID)return;const e=new r.g.AbortController,t=e.signal;return(async()=>{C(!0);try{const e=await v(i,{signal:t});S(e),C(!1)}catch(e){if(C(!1),!t.aborted)throw e}})(),()=>{e.abort()}}),[i,A]),(0,l.useEffect)((()=>{if(!i||!A||!p||!u||!w||O||h)return;if(i!==A.imdbID)return;const{imdbID:e,Released:t,Title:r,Genre:n}=A,s={};e!==I?.imdb_id&&(s.meta={...I,imdb_id:e,imdb_release_date:(0,c.date)("Y-m-d",t)}),r!==T&&(s.title=r);const a=n.split(", ").map((e=>e.trim())),d=a.reduce(((e,t)=>{const r=(o=t,g.find((e=>e.name.toLowerCase()===o.toLowerCase())));var o;return r?e.termIds=[...e.termIds,r.id]:e.newTermGenres=[...e.newTermGenres,t],e}),{newTermGenres:[],termIds:[]});if(d.newTermGenres.length){const e=e=>E("taxonomy",o,e,{throwOnError:!0});(async()=>{for(const t of d.newTermGenres){const r=await e({name:t});d.termIds.push(r.id)}if(a.length!==d.termIds.length)throw new Error((0,m.__)("Failed to create all terms.","movie-log"));s[p.rest_base]=d.termIds,D(s)})()}else{if(function(e,t){return t.every((t=>e.includes(t)))}(b,d.termIds)||(s[p.rest_base]=d.termIds),!Object.keys(s).length)return;D(s)}}),[o,E,i,A,p,u,w,O,h,b,g,D,T,I]),(0,y.jsxs)(l.Fragment,{children:[(0,y.jsx)(a.InspectorControls,{children:(0,y.jsxs)(n.PanelBody,{title:(0,m.__)("Movie Settings","movie-log"),children:[(0,y.jsx)(n.TextControl,{label:(0,m.__)("IMDB ID / Search Term","movie-log"),value:j||i,onChange:k}),(0,y.jsx)(n.Button,{onClick:async()=>{if(O||h||!j)return;const e=(new r.g.AbortController).signal;C(!0);try{const r=await v(j,{signal:e});t({imdbId:r.imdbID,imdbReleaseDate:(0,c.date)("Y-m-d",r.Released)}),S(r),k(void 0),C(!1)}catch(t){if(C(!1),!e.aborted)throw t}},disabled:O||h,variant:"secondary",children:(0,m.__)("Update","movie-log")}),O&&(0,y.jsx)(n.Spinner,{})]})}),(0,y.jsxs)("div",{...(0,a.useBlockProps)(),children:[!i&&(0,y.jsx)(n.Placeholder,{children:(0,m.__)("Enter a movie title in the sidebar!","movie-log")}),i&&(0,y.jsx)(n.Disabled,{children:(0,y.jsx)(s(),{block:f.UU,attributes:e,skipBlockSupportAttributes:!0})})]})]})}})}},r={};function o(e){var n=r[e];if(void 0!==n)return n.exports;var i=r[e]={exports:{}};return t[e](i,i.exports,o),i.exports}o.m=t,e=[],o.O=(t,r,n,i)=>{if(!r){var s=1/0;for(c=0;c<e.length;c++){for(var[r,n,i]=e[c],a=!0,d=0;d<r.length;d++)(!1&i||s>=i)&&Object.keys(o.O).every((e=>o.O[e](r[d])))?r.splice(d--,1):(a=!1,i<s&&(s=i));if(a){e.splice(c--,1);var l=n();void 0!==l&&(t=l)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[r,n,i]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={369:0,765:0};o.O.j=t=>0===e[t];var t=(t,r)=>{var n,i,[s,a,d]=r,l=0;if(s.some((t=>0!==e[t]))){for(n in a)o.o(a,n)&&(o.m[n]=a[n]);if(d)var c=d(o)}for(t&&t(r);l<s.length;l++)i=s[l],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(c)},r=globalThis.webpackChunkmovie_log=globalThis.webpackChunkmovie_log||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var n=o.O(void 0,[765],(()=>o(165)));n=o.O(n)})();